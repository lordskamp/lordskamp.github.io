<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Nouman AI - Smart Professional Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.3/purify.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #ef4444;
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --glass: rgba(59, 130, 246, 0.08);
            --glass-border: rgba(59, 130, 246, 0.2);
            --glass-hover: rgba(59, 130, 246, 0.15);
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            color: var(--text-primary);
            min-height: 100dvh;
            overflow-x: hidden;
            position: relative;
        }

        @supports (min-height: 100svh) {
            body {
                min-height: 100svh;
            }
        }

        /* iOS-safe fullscreen containers */
        .fullscreen {
            min-height: 100dvh;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            box-sizing: border-box;
        }

        @supports (min-height: 100svh) {
            .fullscreen {
                min-height: 100svh;
            }
        }

        /* Animated background particles */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary);
            border-radius: 50%;
            animation: float 20s infinite linear;
            opacity: 0.3;
        }

        @keyframes float {
            0% {
                transform: translateY(100dvh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.3;
            }
            90% {
                opacity: 0.3;
            }
            100% {
                transform: translateY(-10px) rotate(360deg);
                opacity: 0;
            }
        }

        @supports (transform: translateY(100svh)) {
            @keyframes float {
                0% {
                    transform: translateY(100svh) rotate(0deg);
                    opacity: 0;
                }
                10% {
                    opacity: 0.3;
                }
                90% {
                    opacity: 0.3;
                }
                100% {
                    transform: translateY(-10px) rotate(360deg);
                    opacity: 0;
                }
            }
        }

        /* Glass morphism effects */
        .glass {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .glass:hover {
            background: var(--glass-hover);
        }

        /* Enhanced animations */
        @keyframes slideInUp {
            from {
                transform: translateY(60px);
                opacity: 0;
                filter: blur(10px);
            }
            to {
                transform: translateY(0);
                opacity: 1;
                filter: blur(0);
            }
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-60px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(60px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .animate-slide-up {
            animation: slideInUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .animate-slide-left {
            animation: slideInLeft 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .animate-slide-right {
            animation: slideInRight 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* Premium input styling */
        .premium-input {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 25px;
            padding: 16px 24px;
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
        }

        .premium-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .premium-input::placeholder {
            color: var(--text-muted);
        }

        /* Enhanced button styling */
        .premium-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            font-size: 18px;
            position: relative;
            overflow: hidden;
        }

        .premium-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .premium-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.5);
        }

        .premium-btn:hover::before {
            left: 100%;
        }

        .premium-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        /* Enhanced message styles */
        .message-wrapper {
            margin-bottom: 2rem;
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.6s ease-out forwards;
        }

        .user-message {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 20px 20px 5px 20px;
            padding: 1rem 1.5rem;
            max-width: 70%;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .bot-message {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px 20px 20px 5px;
            padding: 1.5rem;
            max-width: 85%;
            position: relative;
            overflow: hidden;
        }

        .bot-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
        }

        /* Enhanced avatar */
        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
            overflow: hidden;
        }

        .user-avatar {
            background: linear-gradient(135deg, var(--secondary), #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .bot-avatar {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            animation: pulse 3s ease-in-out infinite;
        }

        /* Visualization enhancements */
        .visualization-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            margin: 1.5rem 0;
            overflow: hidden;
            position: relative;
        }

        .viz-header {
            background: rgba(59, 130, 246, 0.1);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viz-title {
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .viz-actions {
            display: flex;
            gap: 0.5rem;
        }

        .viz-btn {
            padding: 0.5rem 1rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .viz-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        .viz-content {
            padding: 1.5rem;
        }

        /* Enhanced status indicators */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-processing {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Quick action buttons */
        .quick-action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .quick-action {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .quick-action::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.6s;
        }

        .quick-action:hover::before {
            left: 100%;
        }

        .quick-action:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
        }

        .quick-action-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
            transition: transform 0.3s ease;
        }

        .quick-action:hover .quick-action-icon {
            transform: scale(1.1);
        }

        /* Session info panel */
        .session-panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .session-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .session-metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: var(--text-secondary);
        }

        .metric-value {
            color: var(--primary);
            font-weight: 600;
        }

        /* Loading states */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: var(--glass);
            border-radius: 20px;
            margin: 1rem 0;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: typing 1.4s ease-in-out infinite both;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Enhanced table styles */
        .nouman-table {
            width: 100%;
            border-collapse: collapse;
            background: transparent;
        }

        .nouman-table th {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            padding: 1rem 1.5rem;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            border-bottom: 2px solid var(--primary);
        }

        .nouman-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .nouman-table tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        /* Chart container enhancements */
        .chart-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
        }

        .chart-title {
            color: var(--primary);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Bar chart specific styles */
        .bar {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            transition: transform 0.3s ease;
        }

        .bar:hover {
            transform: translateX(5px);
        }

        .bar-label {
            width: 150px;
            font-weight: 600;
            margin-right: 1rem;
            color: var(--text-primary);
        }

        .bar-fill {
            height: 30px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            border-radius: 15px;
            display: flex;
            align-items: center;
            color: white;
            padding: 0 1rem;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .bar-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.8s;
        }

        .bar:hover .bar-fill::before {
            left: 100%;
        }

        /* Timeline enhancements */
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin: 2rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            border-radius: 2px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2.5rem;
            padding-left: 2.5rem;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem 1.5rem 1.5rem 4rem;
            transition: all 0.3s ease;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -0.75rem;
            top: 1.5rem;
            width: 1.5rem;
            height: 1.5rem;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            border: 3px solid var(--bg-primary);
        }

        .timeline-item:hover {
            transform: translateX(10px);
            border-color: var(--primary);
        }

        .timeline-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .timeline-subtitle {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .timeline-period {
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .premium-input {
                font-size: 14px;
                padding: 14px 20px;
            }
            
            .quick-action-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .bot-message, .user-message {
                max-width: 95%;
            }
            
            .timeline-item {
                padding: 1rem 1rem 1rem 3rem;
            }
        }

        /* Domain filtering notice */
        .domain-notice {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            color: var(--warning);
        }

        .domain-notice .icon {
            color: var(--warning);
            margin-right: 0.5rem;
        }

        /* SQL query indicator */
        .sql-indicator {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 10px;
            padding: 0.5rem 1rem;
            margin: 0.5rem 0;
            font-size: 0.8rem;
            color: var(--success);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Profile image elements (header / avatars) */
        .has-profile {
            cursor: pointer;
            display: inline-block;
        }

        /* Floating profile preview that follows the mouse */
        #profilePreview {
            position: fixed;
            z-index: 60;
            pointer-events: none;
            display: none;
            transform: translate(-50%, -110%);
            transition: transform 0.08s ease-out, opacity 0.12s ease;
            width: 160px;
            height: 160px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(2,6,23,0.6);
            border: 4px solid rgba(255,255,255,0.04);
        }

        #profilePreview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Highlight links in responses */
        .response-link {
            color: white;
            background: linear-gradient(90deg, rgba(59,130,246,0.12), rgba(29,78,216,0.12));
            padding: 0.15rem 0.4rem;
            border-radius: 6px;
            text-decoration: none;
            border: 1px solid rgba(59,130,246,0.12);
        }

        .response-link:hover {
            background: linear-gradient(90deg, rgba(59,130,246,0.18), rgba(29,78,216,0.18));
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Animated background particles -->
    <div class="bg-particles" id="particles"></div>

    <!-- Main Container -->
    <div class="fullscreen flex flex-col">
        <!-- Enhanced Header -->
        <header class="p-6 relative z-10">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center text-2xl shadow-lg overflow-hidden">
                            <img src="profile.jpeg" alt="Nouman" class="w-full h-full object-cover rounded-2xl has-profile" data-profile="profile.jpeg">
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-white to-blue-400 bg-clip-text text-transparent">
                                Nouman AI Assistant
                            </h1>
                            <p class="text-sm text-gray-400">Smart Professional Knowledge Base</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <!-- Session Info -->
                        <div id="sessionInfo" class="session-panel hidden">
                            <div class="session-metric">
                                <span class="metric-label">Session</span>
                                <span class="metric-value" id="sessionId">New</span>
                            </div>
                            <div class="session-metric">
                                <span class="metric-label">Queries</span>
                                <span class="metric-value" id="queryCount">0</span>
                            </div>
                        </div>
                        
                        <button id="clearSession" class="glass rounded-lg px-4 py-2 text-sm hover:bg-blue-500/10 transition-all">
                            <i class="fas fa-refresh mr-2"></i>New Session
                        </button>
                    </div>
                </div>
                
                <!-- Capabilities Banner -->
                <div id="capabilitiesBanner" class="mt-4 glass rounded-lg p-3 text-center text-sm">
                    <i class="fas fa-shield-alt text-blue-400 mr-2"></i>
                    <span class="text-gray-300">Domain-focused AI • Smart SQL queries • Interactive visualizations • Context-aware responses</span>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col relative z-10">
            <!-- Response Container -->
            <div id="responseContainer" class="flex-1 p-6 overflow-y-auto">
                <div class="max-w-7xl mx-auto h-full">
                    <!-- Initial State -->
                    <div id="initialState" class="text-center py-20 h-full flex flex-col justify-center">
                        <div class="animate-fade-in">
                            <div class="w-32 h-32 mx-auto mb-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl flex items-center justify-center text-5xl shadow-2xl overflow-hidden">
                                <img src="profile.jpeg" alt="Nouman" class="w-28 h-28 object-cover rounded-2xl has-profile" data-profile="profile.jpeg">
                            </div>
                            <h2 class="text-5xl font-bold mb-6 bg-gradient-to-r from-white via-blue-200 to-blue-400 bg-clip-text text-transparent">
                                Muhammad Nouman Khan
                            </h2>
                            <p class="text-xl text-gray-400 mb-4 max-w-3xl mx-auto">
                                Your intelligent AI assistant with deep knowledge about Nouman's expertise, projects, and professional journey.
                            </p>
                            <p class="text-sm text-gray-500 mb-8">
                                Ask about skills, experience, projects, certifications, or any professional topic.
                            </p>
                            
                            <!-- Enhanced Quick Actions -->
                            <div class="quick-action-grid max-w-4xl mx-auto">
                                <div class="quick-action" onclick="quickQuery('What are Nouman\'s top technical skills?')">
                                    <i class="fas fa-code quick-action-icon text-blue-400"></i>
                                    <div class="font-semibold mb-1">Technical Skills</div>
                                    <div class="text-xs text-gray-400">Programming languages & frameworks</div>
                                </div>
                                <div class="quick-action" onclick="quickQuery('Show me Nouman\'s work experience timeline')">
                                    <i class="fas fa-briefcase quick-action-icon text-green-400"></i>
                                    <div class="font-semibold mb-1">Work Experience</div>
                                    <div class="text-xs text-gray-400">Career history & positions</div>
                                </div>
                                <div class="quick-action" onclick="quickQuery('What projects has Nouman worked on?')">
                                    <i class="fas fa-project-diagram quick-action-icon text-purple-400"></i>
                                    <div class="font-semibold mb-1">Projects</div>
                                    <div class="text-xs text-gray-400">Portfolio & technical projects</div>
                                </div>
                                <div class="quick-action" onclick="quickQuery('List Nouman\'s certifications and achievements')">
                                    <i class="fas fa-certificate quick-action-icon text-yellow-400"></i>
                                    <div class="font-semibold mb-1">Certifications</div>
                                    <div class="text-xs text-gray-400">Professional credentials</div>
                                </div>
                                <div class="quick-action" onclick="quickQuery('Tell me about Nouman\'s AI and machine learning expertise')">
                                    <i class="fas fa-brain quick-action-icon text-red-400"></i>
                                    <div class="font-semibold mb-1">AI Expertise</div>
                                    <div class="text-xs text-gray-400">Machine learning & AI projects</div>
                                </div>
                                <div class="quick-action" onclick="quickQuery('How can I contact Nouman?')">
                                    <i class="fas fa-envelope quick-action-icon text-indigo-400"></i>
                                    <div class="font-semibold mb-1">Contact Info</div>
                                    <div class="text-xs text-gray-400">Professional contacts & links</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Response Content -->
                    <div id="dynamicContent" class="hidden h-full space-y-6">
                        <!-- Content will be dynamically generated here -->
                    </div>
                </div>
            </div>

            <!-- Enhanced Input Area -->
            <div class="p-6 border-t border-white/10 relative z-10">
                <div class="max-w-4xl mx-auto">
                    <div class="flex gap-4 items-center">
                        <div class="relative flex-1">
                            <input 
                                type="text" 
                                id="queryInput" 
                                class="premium-input w-full" 
                                placeholder="Ask me anything about Muhammad Nouman Khan's professional background..."
                                onkeypress="handleKeyPress(event)"
                            >
                            <div id="suggestionDropdown" class="absolute top-full left-0 right-0 mt-2 glass rounded-lg border-gray-600 hidden z-20">
                                <!-- Dynamic suggestions will appear here -->
                            </div>
                        </div>
                        <button id="sendBtn" class="premium-btn" onclick="sendQuery()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    
                    <!-- Enhanced Status Bar -->
                    <div class="mt-4 flex items-center justify-between">
                        <div id="statusBar" class="status-indicator status-success">
                            <i class="fas fa-circle"></i>
                            <span>Ready to assist with Nouman-related queries</span>
                        </div>
                        
                        <div class="flex items-center gap-3 text-xs text-gray-500">
                            <div id="responseStats" class="hidden">
                                <i class="fas fa-database mr-1"></i>
                                <span id="queryType">Smart SQL</span> •
                                <i class="fas fa-clock mr-1"></i>
                                <span id="executionTime">0.0s</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Floating profile preview -->
    <div id="profilePreview"><img src="profile.jpeg" alt="Preview"></div>

    <!-- Enhanced Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass rounded-2xl p-8 text-center max-w-sm mx-4">
            <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center">
                <i class="fas fa-brain text-white text-2xl animate-pulse"></i>
            </div>
            <div class="typing-dots mb-4 justify-center">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            <div class="text-lg font-medium mb-2">AI is analyzing your query...</div>
            <div class="text-sm text-gray-400" id="loadingStatus">Generating targeted response</div>
        </div>
    </div>

    <!-- Domain Filter Notice -->
    <div id="domainNotice" class="fixed top-6 right-6 z-40 hidden">
        <div class="domain-notice animate-slide-right">
            <i class="fas fa-info-circle icon"></i>
            <span>This assistant focuses only on Nouman's professional profile</span>
        </div>
    </div>

    <script>
        // Configuration
        // const API_BASE_URL = 'http://localhost:8000';
        const API_BASE_URL = 'https://me-ai-production.up.railway.app';
        
        // State Management
        let currentSessionId = null;
        let isProcessing = false;
        let queryCount = 0;
        let sessionStartTime = null;
        
        // DOM Elements
        const initialState = document.getElementById('initialState');
        const dynamicContent = document.getElementById('dynamicContent');
        const queryInput = document.getElementById('queryInput');
        const sendBtn = document.getElementById('sendBtn');
        const statusBar = document.getElementById('statusBar');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingStatus = document.getElementById('loadingStatus');
        const clearSessionBtn = document.getElementById('clearSession');
        const sessionInfo = document.getElementById('sessionInfo');
        const sessionId = document.getElementById('sessionId');
        const queryCountEl = document.getElementById('queryCount');
        const responseStats = document.getElementById('responseStats');
        const domainNotice = document.getElementById('domainNotice');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            queryInput.focus();
            clearSessionBtn.addEventListener('click', clearSession);
            createParticles();
            loadCapabilities();
            
            marked.setOptions({
                gfm: true,
                breaks: true,
                sanitize: false
            });

            // Add input suggestions
            queryInput.addEventListener('input', handleInputSuggestions);

            // Attach hover preview to any existing profile images
            attachProfilePreviewHandlers();
        });

        // Create floating particles background
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (20 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Load assistant capabilities
        async function loadCapabilities() {
            try {
                const response = await fetch(`${API_BASE_URL}/nouman/capabilities`);
                if (response.ok) {
                    const data = await response.json();
                    console.log('Assistant capabilities loaded:', data);
                    // Store capabilities for suggestions
                    window.noumanCapabilities = data;
                }
            } catch (error) {
                console.warn('Could not load capabilities:', error);
            }
        }

        // Input suggestions based on capabilities
        function handleInputSuggestions(event) {
            const input = event.target.value.toLowerCase();
            const dropdown = document.getElementById('suggestionDropdown');
            
            if (input.length < 2) {
                dropdown.classList.add('hidden');
                return;
            }

            const suggestions = [
                "What are Nouman's technical skills?",
                "Show me Nouman's work experience timeline",
                "List Nouman's projects with Python",
                "Tell me about Nouman's AI expertise",
                "What certifications does Nouman have?",
                "Show Nouman's education background",
                "Create a chart of Nouman's skill levels",
                "What machine learning projects has Nouman worked on?",
                "How can I contact Nouman professionally?",
                "What programming languages does Nouman know?"
            ].filter(s => s.toLowerCase().includes(input));

            if (suggestions.length > 0) {
                dropdown.innerHTML = suggestions.slice(0, 5).map(suggestion => 
                    `<div class="p-3 hover:bg-blue-500/10 cursor-pointer border-b border-gray-700 last:border-b-0" 
                          onclick="selectSuggestion('${suggestion.replace(/'/g, "\\'")}')">${suggestion}</div>`
                ).join('');
                dropdown.classList.remove('hidden');
            } else {
                dropdown.classList.add('hidden');
            }
        }

        function selectSuggestion(suggestion) {
            queryInput.value = suggestion;
            document.getElementById('suggestionDropdown').classList.add('hidden');
            queryInput.focus();
        }

        // Enhanced HTML detection and processing
        function detectAndProcessHTML(text) {
            const htmlMatches = [];
            
            // Detect various HTML patterns
            const patterns = [
                /```html\s*([\s\S]*?)```/gi,
                /<(?:table|div|svg|style)[^>]*>[\s\S]*?<\/(?:table|div|svg|style)>/gi,
                /<style[^>]*>[\s\S]*?<\/style>/gi
            ];
            
            patterns.forEach(pattern => {
                let match;
                pattern.lastIndex = 0;
                while ((match = pattern.exec(text)) !== null) {
                    htmlMatches.push({
                        type: 'html',
                        html: match[1] || match[0],
                        fullMatch: match[0],
                        index: match.index,
                        endIndex: match.index + match[0].length
                    });
                }
            });
            
            return htmlMatches.sort((a, b) => a.index - b.index);
        }

        function createVisualizationContainer(htmlContent, title = "Data Visualization") {
            const container = document.createElement('div');
            container.className = 'visualization-container animate-fade-in';
            
            const header = document.createElement('div');
            header.className = 'viz-header';
            
            const titleEl = document.createElement('div');
            titleEl.className = 'viz-title';
            titleEl.innerHTML = `<i class="fas fa-chart-bar"></i>${title}`;
            
            const actions = document.createElement('div');
            actions.className = 'viz-actions';
            
            const viewBtn = document.createElement('button');
            viewBtn.className = 'viz-btn';
            viewBtn.innerHTML = '<i class="fas fa-expand-alt"></i>Full View';
            viewBtn.onclick = () => openVisualizationModal(htmlContent, title);
            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'viz-btn';
            copyBtn.innerHTML = '<i class="fas fa-copy"></i>Copy HTML';
            copyBtn.onclick = () => copyToClipboard(htmlContent);
            
            actions.appendChild(viewBtn);
            actions.appendChild(copyBtn);
            
            header.appendChild(titleEl);
            header.appendChild(actions);
            
            const content = document.createElement('div');
            content.className = 'viz-content';
            content.innerHTML = htmlContent;
            
            container.appendChild(header);
            container.appendChild(content);
            
            return container;
        }

        function openVisualizationModal(htmlContent, title) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            const modalContent = document.createElement('div');
            modalContent.className = 'glass rounded-2xl p-6 max-w-6xl w-full max-h-[90vh] overflow-auto';
            
            const modalHeader = document.createElement('div');
            modalHeader.className = 'flex justify-between items-center mb-4 pb-4 border-b border-gray-600';
            modalHeader.innerHTML = `
                <h3 class="text-xl font-bold text-blue-400"><i class="fas fa-chart-bar mr-2"></i>${title}</h3>
                <button onclick="this.closest('.fixed').remove()" 
                        class="text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            `;
            
            const modalBody = document.createElement('div');
            modalBody.innerHTML = htmlContent;
            
            modalContent.appendChild(modalHeader);
            modalContent.appendChild(modalBody);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

        // Input handling
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendQuery();
            } else if (event.key === 'Escape') {
                document.getElementById('suggestionDropdown').classList.add('hidden');
            }
        }

        function quickQuery(query) {
            queryInput.value = query;
            sendQuery();
        }

        // Enhanced query function with smart processing
        async function sendQuery() {
            const query = queryInput.value.trim();
            if (!query || isProcessing) return;

            // Hide suggestions
            document.getElementById('suggestionDropdown').classList.add('hidden');

            // Show conversation area
            initialState.classList.add('hidden');
            dynamicContent.classList.remove('hidden');
            sessionInfo.classList.remove('hidden');

            appendMessage(query, 'user');
            queryInput.value = '';
            
            isProcessing = true;
            showLoading(true);
            updateStatus('AI analyzing query...', 'processing');

            try {
                const requestBody = {
                    message: query,
                    session_id: currentSessionId,
                    // include_visualization: true
                    include_visualization: false
                };

                updateLoadingMessage('Generating smart SQL query...');

                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                updateLoadingMessage('Processing retrieved data...');

                const data = await response.json();
                
                // Update session info
                currentSessionId = data.session_id;
                queryCount++;
                updateSessionInfo(data);
                
                // Check if this was a domain-filtered response
                if (data.response.includes("focus specifically on questions about Nouman")) {
                    showDomainNotice();
                }
                
                appendMessage(data.response, 'bot', data);
                
                updateStatus(`Response generated in ${data.execution_time}s`, 'success');
                updateResponseStats(data);

            } catch (error) {
                console.error('Error:', error);
                appendMessage(
                    'Failed to connect to Nouman AI service. Please ensure the backend is running and try again.', 
                    'bot'
                );
                updateStatus('Connection error - Check backend service', 'error');
            } finally {
                isProcessing = false;
                showLoading(false);
                queryInput.focus();
            }
        }

        function updateLoadingMessage(message) {
            if (loadingStatus) {
                loadingStatus.textContent = message;
            }
        }

        function updateSessionInfo(data) {
            if (sessionStartTime === null) {
                sessionStartTime = new Date();
            }
            
            sessionId.textContent = data.session_id.substring(0, 8) + '...';
            queryCountEl.textContent = queryCount.toString();
        }

        function updateResponseStats(data) {
            const queryType = data.sql_query_used ? 'Smart SQL' : 'Direct';
            const executionTime = data.execution_time.toFixed(2) + 's';
            
            document.getElementById('queryType').textContent = queryType;
            document.getElementById('executionTime').textContent = executionTime;
            responseStats.classList.remove('hidden');
        }

        function showDomainNotice() {
            domainNotice.classList.remove('hidden');
            setTimeout(() => {
                domainNotice.classList.add('hidden');
            }, 5000);
        }

        // function appendMessage(text, sender, metadata = null) {
        //     const messageWrapper = document.createElement('div');
        //     messageWrapper.className = `message-wrapper flex items-start gap-4 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

        //     if (sender === 'user') {
        //         const avatar = document.createElement('div');
        //         avatar.className = 'avatar user-avatar';
        //         avatar.innerHTML = '<i class="fas fa-user"></i>';
                
        //         const messageBubble = document.createElement('div');
        //         messageBubble.className = 'user-message';
        //         messageBubble.textContent = text;
                
        //         messageWrapper.appendChild(messageBubble);
        //         messageWrapper.appendChild(avatar);
        //     } else {
        //         const avatar = document.createElement('div');
        //         avatar.className = 'avatar bot-avatar';
        //         avatar.innerHTML = '<i class="fas fa-robot"></i>';
                
        //         const messageContainer = document.createElement('div');
        //         messageContainer.className = 'flex-1 max-w-5xl';
                
        //         // Add metadata indicators
        //         if (metadata) {
        //             const metaContainer = document.createElement('div');
        //             metaContainer.className = 'flex gap-2 mb-2';
                    
        //             if (metadata.data_retrieved) {
        //                 const sqlIndicator = document.createElement('div');
        //                 sqlIndicator.className = 'sql-indicator';
        //                 sqlIndicator.innerHTML = '<i class="fas fa-database"></i>Smart SQL Query';
        //                 metaContainer.appendChild(sqlIndicator);
        //             }
                    
        //             if (metadata.contains_html) {
        //                 const htmlIndicator = document.createElement('div');
        //                 htmlIndicator.className = 'sql-indicator';
        //                 htmlIndicator.style.background = 'rgba(245, 158, 11, 0.1)';
        //                 htmlIndicator.style.borderColor = 'rgba(245, 158, 11, 0.3)';
        //                 htmlIndicator.style.color = '#f59e0b';
        //                 htmlIndicator.innerHTML = '<i class="fas fa-code"></i>Includes Visualization';
        //                 metaContainer.appendChild(htmlIndicator);
        //             }
                    
        //             messageContainer.appendChild(metaContainer);
        //         }
                
        //         // Process the message content
        //         const htmlMatches = detectAndProcessHTML(text);
                
        //         if (htmlMatches.length > 0) {
        //             let currentIndex = 0;
                    
        //             htmlMatches.forEach((htmlMatch, matchIndex) => {
        //                 // Add text before HTML
        //                 if (currentIndex < htmlMatch.index) {
        //                     const beforeText = text.substring(currentIndex, htmlMatch.index).trim();
        //                     if (beforeText) {
        //                         const textBubble = document.createElement('div');
        //                         textBubble.className = 'bot-message mb-4';
        //                         textBubble.innerHTML = DOMPurify.sanitize(marked.parse(beforeText));
        //                         messageContainer.appendChild(textBubble);
        //                     }
        //                 }
                        
        //                 // Create visualization container
        //                 const vizContainer = createVisualizationContainer(
        //                     htmlMatch.html, 
        //                     `Nouman's Data Visualization #${matchIndex + 1}`
        //                 );
        //                 messageContainer.appendChild(vizContainer);
                        
        //                 currentIndex = htmlMatch.endIndex;
        //             });
                    
        //             // Add remaining text
        //             if (currentIndex < text.length) {
        //                 const remainingText = text.substring(currentIndex).trim();
        //                 if (remainingText) {
        //                     const textBubble = document.createElement('div');
        //                     textBubble.className = 'bot-message mt-4';
        //                     textBubble.innerHTML = DOMPurify.sanitize(marked.parse(remainingText));
        //                     messageContainer.appendChild(textBubble);
        //                 }
        //             }
        //         } else {
        //             // Regular message
        //             const messageBubble = document.createElement('div');
        //             messageBubble.className = 'bot-message';
        //             messageBubble.innerHTML = DOMPurify.sanitize(marked.parse(text));
        //             messageContainer.appendChild(messageBubble);
        //         }
                
        //         messageWrapper.appendChild(avatar);
        //         messageWrapper.appendChild(messageContainer);
        //     }

        //     dynamicContent.appendChild(messageWrapper);
        //     scrollToBottom();
        // }

        function appendMessage(text, sender, metadata = null) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `message-wrapper flex items-start gap-4 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

            if (sender === 'user') {
                const avatar = document.createElement('div');
                avatar.className = 'avatar user-avatar';
                // Use a generic user icon for the user's avatar so profile.jpeg remains for bot responses
                avatar.innerHTML = '<i class="fas fa-user"></i>';

                const messageBubble = document.createElement('div');
                messageBubble.className = 'user-message';
                messageBubble.textContent = text;

                messageWrapper.appendChild(messageBubble);
                messageWrapper.appendChild(avatar);
            } else {
                const avatar = document.createElement('div');
                avatar.className = 'avatar bot-avatar';
                const img = document.createElement('img');
                img.src = 'profile.jpeg';
                img.alt = 'Nouman';
                img.className = 'w-full h-full object-cover has-profile';
                img.setAttribute('data-profile', 'profile.jpeg');
                avatar.appendChild(img);

                const messageContainer = document.createElement('div');
                messageContainer.className = 'flex-1 max-w-5xl';

                // Add metadata indicators
                if (metadata) {
                    const metaContainer = document.createElement('div');
                    metaContainer.className = 'flex gap-2 mb-2';

                    if (metadata.data_retrieved) {
                        const sqlIndicator = document.createElement('div');
                        sqlIndicator.className = 'sql-indicator';
                        sqlIndicator.innerHTML = '<i class="fas fa-database"></i>Smart SQL Query';
                        metaContainer.appendChild(sqlIndicator);
                    }

                    if (metadata.contains_html) {
                        const htmlIndicator = document.createElement('div');
                        htmlIndicator.className = 'sql-indicator';
                        htmlIndicator.style.background = 'rgba(245, 158, 11, 0.1)';
                        htmlIndicator.style.borderColor = 'rgba(245, 158, 11, 0.3)';
                        htmlIndicator.style.color = '#f59e0b';
                        htmlIndicator.innerHTML = '<i class="fas fa-code"></i>Includes Visualization';
                        metaContainer.appendChild(htmlIndicator);
                    }

                    messageContainer.appendChild(metaContainer);
                }

                // Process the message content: parse markdown, sanitize, convert links to styled anchors
                const rawHtml = marked.parse(text);
                const sanitized = DOMPurify.sanitize(rawHtml);

                const tmp = document.createElement('div');
                tmp.innerHTML = sanitized;
                tmp.querySelectorAll('a').forEach(a => {
                    a.classList.add('response-link');
                    a.setAttribute('target', '_blank');
                    a.setAttribute('rel', 'noopener noreferrer');
                });

                // Append processed content
                while (tmp.firstChild) messageContainer.appendChild(tmp.firstChild);

                // Attach preview handlers to any images inside messageContainer
                messageContainer.querySelectorAll('.has-profile').forEach(el => {
                    if (!el.dataset.previewAttached) {
                        el.addEventListener('mouseenter', showProfilePreview);
                        el.addEventListener('mouseleave', hideProfilePreview);
                        el.addEventListener('mousemove', moveProfilePreview);
                        el.dataset.previewAttached = '1';
                    }
                });

                messageWrapper.appendChild(avatar);
                messageWrapper.appendChild(messageContainer);
            }

            dynamicContent.appendChild(messageWrapper);
            // Attach handlers for any newly added profile images or links
            attachProfilePreviewHandlers();
            // Ensure links inside new message open in new tab and have class
            messageWrapper.querySelectorAll('a').forEach(a => {
                a.classList.add('response-link');
                a.setAttribute('target', '_blank');
                a.setAttribute('rel', 'noopener noreferrer');
            });
            scrollToBottom();
        }
        function scrollToBottom() {
            const container = document.getElementById('responseContainer');
            container.scrollTop = container.scrollHeight;
        }

        // Enhanced loading states
        function showLoading(show) {
            if (show) {
                loadingOverlay.classList.remove('hidden');
                sendBtn.disabled = true;
                sendBtn.innerHTML = '<i class="fas fa-spinner animate-spin"></i>';
                
                // Add typing indicator
                const typingIndicator = document.createElement('div');
                typingIndicator.id = 'typingIndicator';
                typingIndicator.className = 'typing-indicator';
                typingIndicator.innerHTML = `
                    <div class="avatar bot-avatar">
                        <img src="profile.jpeg" class="w-full h-full object-cover has-profile" data-profile="profile.jpeg" alt="Nouman">
                    </div>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span class="text-sm text-gray-400 ml-2">Nouman AI is thinking...</span>
                `;
                dynamicContent.appendChild(typingIndicator);
                attachProfilePreviewHandlers();
                scrollToBottom();
            } else {
                loadingOverlay.classList.add('hidden');
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
                
                // Remove typing indicator
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
        }

        // Profile preview helpers
        function attachProfilePreviewHandlers() {
            document.querySelectorAll('.has-profile').forEach(el => {
                if (!el.dataset.previewAttached) {
                    el.addEventListener('mouseenter', showProfilePreview);
                    el.addEventListener('mouseleave', hideProfilePreview);
                    el.addEventListener('mousemove', moveProfilePreview);
                    el.dataset.previewAttached = '1';
                }
            });
        }

        function showProfilePreview(e) {
            const preview = document.getElementById('profilePreview');
            const src = e.currentTarget.dataset.profile || e.currentTarget.src || 'profile.jpeg';
            preview.querySelector('img').src = src;
            preview.style.display = 'block';
            preview.style.opacity = '1';
            moveProfilePreview(e);
        }

        function moveProfilePreview(e) {
            const preview = document.getElementById('profilePreview');
            const x = e.clientX;
            const y = e.clientY;
            preview.style.left = x + 'px';
            preview.style.top = y + 'px';
            preview.style.transform = 'translate(-50%, -120%) scale(1)';
        }

        function hideProfilePreview() {
            const preview = document.getElementById('profilePreview');
            preview.style.opacity = '0';
            preview.style.display = 'none';
        }

        function updateStatus(message, type = 'default') {
            const statusClasses = {
                success: 'status-success',
                error: 'status-error',
                processing: 'status-processing',
                default: 'status-success'
            };
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-triangle',
                processing: 'fas fa-brain animate-pulse',
                default: 'fas fa-circle'
            };
            
            statusBar.className = `status-indicator ${statusClasses[type]}`;
            statusBar.innerHTML = `<i class="${icons[type]}"></i><span>${message}</span>`;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    updateStatus('Ready for your next question about Nouman', 'default');
                }, 3000);
            }
        }

        function clearSession() {
            currentSessionId = null;
            queryCount = 0;
            sessionStartTime = null;
            
            initialState.classList.remove('hidden');
            dynamicContent.classList.add('hidden');
            sessionInfo.classList.add('hidden');
            responseStats.classList.add('hidden');
            
            dynamicContent.innerHTML = '';
            queryInput.value = '';
            
            updateStatus('New session started - Ask me about Nouman!', 'success');
            queryInput.focus();
            
            // Recreate particles for fresh feel
            document.getElementById('particles').innerHTML = '';
            createParticles();
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                updateStatus('HTML copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                updateStatus('Failed to copy HTML', 'error');
            });
        }

        // Export session functionality
        async function exportSession() {
            if (!currentSessionId) {
                updateStatus('No active session to export', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/session/${currentSessionId}/export`);
                if (response.ok) {
                    const data = await response.json();
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `nouman-ai-session-${data.session_id.substring(0, 8)}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    updateStatus('Session exported successfully', 'success');
                } else {
                    updateStatus('Failed to export session', 'error');
                }
            } catch (error) {
                console.error('Export error:', error);
                updateStatus('Export failed', 'error');
            }
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'k':
                        e.preventDefault();
                        queryInput.focus();
                        break;
                    case 'n':
                        e.preventDefault();
                        clearSession();
                        break;
                    case 'e':
                        e.preventDefault();
                        exportSession();
                        break;
                }
            }
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('suggestionDropdown');
            if (!e.target.closest('#queryInput') && !e.target.closest('#suggestionDropdown')) {
                dropdown.classList.add('hidden');
            }
        });

        // Health check on load
        async function checkBackendHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    const health = await response.json();
                    console.log('Backend health:', health);
                    updateStatus('Connected to Nouman AI backend', 'success');
                } else {
                    updateStatus('Backend service unavailable', 'error');
                }
            } catch (error) {
                console.error('Health check failed:', error);
                updateStatus('Cannot connect to backend service', 'error');
            }
        }

        // Initialize health check
        setTimeout(checkBackendHealth, 1000);

        // Auto-save session state
        setInterval(() => {
            if (currentSessionId && sessionStartTime) {
                const sessionData = {
                    sessionId: currentSessionId,
                    queryCount: queryCount,
                    startTime: sessionStartTime,
                    lastActivity: new Date()
                };
                localStorage.setItem('noumanAiSession', JSON.stringify(sessionData));
            }
        }, 30000); // Save every 30 seconds

        // Restore session on page load
        window.addEventListener('load', () => {
            const savedSession = localStorage.getItem('noumanAiSession');
            if (savedSession) {
                try {
                    const sessionData = JSON.parse(savedSession);
                    const timeSinceLastActivity = new Date() - new Date(sessionData.lastActivity);
                    
                    // Restore session if less than 1 hour old
                    if (timeSinceLastActivity < 3600000) {
                        currentSessionId = sessionData.sessionId;
                        queryCount = sessionData.queryCount;
                        sessionStartTime = new Date(sessionData.startTime);
                        
                        updateStatus('Previous session restored', 'success');
                    }
                } catch (error) {
                    console.warn('Could not restore session:', error);
                }
            }
        });
    </script>
</body>
</html>
